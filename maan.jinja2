{% from 'opmaak.jinja' import komma %}

{% set zon = states('sun.sun') %}

{% set maanfase = states('sensor.moon') %}

{% set maanfase_mapping = {
    'new_moon': 'ğŸŒ‘',
    'waxing_crescent': 'ğŸŒ’',
    'first_quarter': 'ğŸŒ“',
    'waxing_gibbous': 'ğŸŒ”',
    'full_moon': 'ğŸŒ•',
    'waning_gibbous': 'ğŸŒ–',
    'last_quarter': 'ğŸŒ—',
    'waning_crescent': 'ğŸŒ˜'
} %}

{% set maan = maanfase_mapping.get(maanfase, 'ğŸŒ‘') %}  {# Standaard emoji voor onbekende fase #}

{% set regen =
 {
  "huidig_neerslag": states('sensor.easyweatherpro_v5_1_1_rain_rate') | float(0) ,
  "hum": states('sensor.gemiddelde_binnenluchtvochtigheid') | float(0)
  }
%}

{% if regen.huidig_neerslag > 0 %}
    {% set emoji = 'ğŸŒ§ï¸' %}
{% endif %}

{% if zon != 'below_horizon' %}
{% set maan = '' %}
{% endif %}
{{ maan }}
{{ emoji }} Huidige neerslag: {{ komma(regen.huidig_neerslag) }} mm/h {{ emoji }}